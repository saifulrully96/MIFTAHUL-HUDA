<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twibbon Pengajian</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        canvas {
            border: 2px solid #ccc;
            margin-top: 20px;
        }
        input[type="file"] {
            margin-top: 20px;
        }
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        button {
            background-color: #28a745;
            width: 100%;
            padding: 12px;
            font-size: 18px;
            margin-top: 15px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Twibbon Pengajian Miftahul Huda</h1>
        <p>Selamat datang di Twibbon Generator! Ikuti langkah berikut untuk membuat Twibbon untuk Pengajian Miftahul Huda.</p>

        <div class="canvas-container">
            <canvas id="twibbonCanvas" width="600" height="900"></canvas>
        </div>

        <div class="section">
            <label for="uploadPhoto">1. Upload Foto:</label>
            <input type="file" id="uploadPhoto" accept="image/*">
        </div>

        <button id="moveToTwibbonBtn" onclick="moveToTwibbon()" disabled>Posisikan Foto di Bawah Twibbon</button>
        <button id="downloadBtn" onclick="downloadImage()" disabled>Unduh Twibbon</button>
    </div>

    <script>
        const canvas = document.getElementById('twibbonCanvas');
        const ctx = canvas.getContext('2d');

        let uploadedImage = null;
        let imgX = 0, imgY = 0, imgWidth = 600, imgHeight = 900;
        let isDragging = false;
        let startX, startY;

        // Event listener untuk mengunggah foto
        document.getElementById('uploadPhoto').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                uploadedImage = new Image();
                uploadedImage.onload = function() {
                    imgWidth = uploadedImage.width;
                    imgHeight = uploadedImage.height;
                    imgX = (canvas.width - imgWidth) / 2;
                    imgY = (canvas.height - imgHeight) / 2;
                    drawImage();
                };
                uploadedImage.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        // Fungsi untuk menggambar gambar di canvas
        function drawImage() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Bersihkan canvas
            if (uploadedImage) {
                ctx.drawImage(uploadedImage, imgX, imgY, imgWidth, imgHeight);
            }
        }

        // Mengatur interaksi drag untuk menggeser gambar
        canvas.addEventListener('mousedown', (e) => {
            if (e.offsetX > imgX && e.offsetX < imgX + imgWidth && e.offsetY > imgY && e.offsetY < imgY + imgHeight) {
                isDragging = true;
                startX = e.offsetX - imgX;
                startY = e.offsetY - imgY;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                imgX = e.offsetX - startX;
                imgY = e.offsetY - startY;
                drawImage(); // Gambar ulang setelah posisi gambar berubah
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false; // Hentikan drag saat mouse dilepas
        });

        canvas.addEventListener('mouseout', () => {
            isDragging = false; // Hentikan drag jika mouse keluar dari canvas
        });

        // Mengatur interaksi zoom untuk memperbesar atau memperkecil gambar
        canvas.addEventListener('wheel', (e) => {
            const scaleFactor = 1.1; // Faktor zoom
            if (e.deltaY < 0) {
                imgWidth *= scaleFactor;
                imgHeight *= scaleFactor;
            } else {
                imgWidth /= scaleFactor;
                imgHeight /= scaleFactor;
            }

            // Mengatur posisi gambar agar tetap berada di dalam canvas setelah zoom
            imgX = Math.max(0, Math.min(imgX, canvas.width - imgWidth));
            imgY = Math.max(0, Math.min(imgY, canvas.height - imgHeight));

            drawImage(); // Gambar ulang setelah ukuran gambar berubah
        });

        // Fungsi untuk memindahkan foto ke bawah Twibbon
        function moveToTwibbon() {
            if (uploadedImage) {
                imgX = 50; // Atur posisi horizontal
                imgY = 200; // Atur posisi vertikal di bawah Twibbon
                imgWidth = canvas.width - 100; // Sesuaikan ukuran foto
                imgHeight = (imgWidth / uploadedImage.width) * uploadedImage.height; // Menjaga rasio
                drawImage(); // Gambar ulang dengan posisi yang baru
            }
        }

        // Fungsi untuk mengunduh gambar Twibbon yang sudah jadi
        function downloadImage() {
            const dataUrl = canvas.toDataURL("image/png");
            const link = document.createElement("a");
            link.href = dataUrl;
            link.download = "twibbon.png";
            link.click();
        }
    </script>
</body>
</html>
